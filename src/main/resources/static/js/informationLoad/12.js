(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{F6wT:function(e,t,i){"use strict";i.r(t),i.d(t,"PromotionsModule",(function(){return ne}));var s=i("2kYt"),a=i("40Bj"),o=i("nIj0"),r=i("m1yc"),n=i("PCNd"),l=i("sEIs"),d=i("OZ4H"),c=i("EM62"),b=i("ROBh"),m=i("jIqt"),u=i("YtkY"),p=i("ruxD"),h=i("qFEQ"),f=i("29Wa"),g=i("Cd2c"),v=i("ulve"),y=i("R7+U"),C=i("gcUQ"),S=i("mFH5"),N=i("csyo");function R(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("mandatoryField"))}}function j(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("maxOf")+"20 "+e.dictionary.translate("characters"))}}function F(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("mandatoryField"))}}function B(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("maxOf")+"100 "+e.dictionary.translate("characters"))}}function I(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("maxOf")+"20 "+e.dictionary.translate("characters"))}}function P(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("mandatoryField"))}}function x(e,t){if(1&e&&(c.Qb(0),c.Dc(1),c.Pb()),2&e){const e=c.ec();c.Bb(1),c.Ec(e.dictionary.translate("maxOf")+"20 "+e.dictionary.translate("characters"))}}function L(e,t){if(1&e){const e=c.Tb();c.Sb(0,"mat-option",25),c.ac("onSelectionChange",(function(t){return c.sc(e),c.ec().spCodeChanged(t)})),c.Dc(1),c.Rb()}if(2&e){const e=t.$implicit;c.jc("value",e),c.Bb(1),c.Fc(" ",e.spCode," ")}}function D(e,t){1&e&&c.Nb(0,"mat-spinner",26),2&e&&c.jc("diameter",20)}function E(e,t){if(1&e&&(c.Sb(0,"mat-option",27),c.Dc(1),c.Rb()),2&e){const e=t.$implicit;c.jc("value",e),c.Bb(1),c.Fc(" ",e.label," ")}}function w(e,t){if(1&e&&(c.Sb(0,"mat-option",27),c.Dc(1),c.Rb()),2&e){const e=t.$implicit;c.jc("value",e.value),c.Bb(1),c.Fc(" ",e.label," ")}}function O(e,t){1&e&&(c.Sb(0,"mat-error"),c.Sb(1,"small"),c.Dc(2,"Promotion duplicada"),c.Rb(),c.Rb())}let M=(()=>{class e{constructor(e,t,i,s,a,o){this.fb=e,this.fs=t,this.sps=i,this.prs=s,this.ps=a,this.changeDetectorRef=o,this.validDates=!0,this.disabledEvent=new c.o,this.evaluationTypes=[],this.jobTitles=[],this.cursos=[],this.spCodesOptions=[]}ngOnInit(){this.spCodeLoading=!0,this.isNew=!this.data,this.sps.getSpCodes().subscribe(e=>{this.spCodesOptions=e,this.spCodeLoading=!1,this.filteredOptions=this.mainForm.controls.spCode.valueChanges.pipe(Object(m.a)(""),Object(u.a)(e=>"string"==typeof e?e:e.spCode),Object(u.a)(e=>e?this._filter(e):this.spCodesOptions.slice())),this.isNew&&this.spCode.enable()}),this.prs.bringRelPuestos().subscribe(e=>{this.jobTitles=e}),this.ps.bringTheActivesIdPQs().subscribe(e=>{this.cursos=e}),this.setupForm(),this.spCode.disable(),this.idCurso.valueChanges.subscribe(e=>{}),this.idCurso.valueChanges.subscribe(e=>{this.courseName.setValue(e.name)}),this.filteredOptionsCurso=this.idCurso.valueChanges.pipe(Object(m.a)(""),Object(u.a)(e=>this._filterCurso(e)))}displayFn(e){return e&&e.spCode?e.spCode:""}_filter(e){const t=e.toLowerCase();return this.spCodesOptions.filter(e=>e.spCode.toLowerCase().includes(t))}spCodeChanged(e){const t=e.source.value;this.nameSPcode.setValue(t.providerName),this.distributorSPCode.setValue(t.responsibleBranchCode+" - "+t.responsibleBranchName)}_filterCurso(e){const t=e;return this.cursos.filter(e=>e.label.toUpperCase().includes(t))}disableFields(){this.fs.disableFields(this.mainForm)}enableFields(){this.fs.enableFields(this.mainForm),this.isNew||(this.promotionId.disable(),this.name.disable(),this.secondName.disable(),this.lastName.disable(),this.spCode.disable(),this.nameSPcode.disable(),this.distributorSPCode.disable(),this.idCurso.disable(),this.courseName.disable(),this.jobTitle.disable(),this.datePassed.disable())}submit(){const e=this.mainForm.value;let t;return t={promotionId:e.promotionId.toUpperCase(),spCode:e.spCode.spCode,programId:e.idCurso.label,firstName:e.name.toUpperCase(),middleName:e.secondName.toUpperCase(),lastName:e.lastName.toUpperCase(),jobTitle:e.jobTitle,datePassed:e.datePassed.toISOString()},this.prs.save(t)}setupForm(){this.mainForm=this.fb.group({promotionId:[null,[o.s.required,o.s.maxLength(20)]],name:[null,[o.s.required,o.s.maxLength(100)]],secondName:[null,[o.s.maxLength(100)]],lastName:[null,[o.s.required,o.s.maxLength(150)]],spCode:[null,[o.s.required]],nameSPcode:[null,[o.s.required]],distributorSPCode:[null,[o.s.required]],idCurso:[null,[o.s.required,o.s.maxLength(100)]],courseName:[null,[o.s.required]],jobTitle:[null,[o.s.required,o.s.maxLength(50)]],datePassed:[null,[o.s.required]],del:null},{asyncValidators:this.duplicatedPromotion.bind(this)}),this.isNew||(console.log(this.data),this.sps.findByCriteria({spCode:this.data.code.responsibleBranchCode,del:"N"}).subscribe(e=>{this.mainForm.patchValue({promotionId:this.data.promotionId,name:this.data.firstName,secondName:this.data.middleName,lastName:this.data.lastName,idCurso:{label:this.data.program.id,name:this.data.program.nombre,value:this.data.program.id},courseName:this.data.program.nombre,jobTitle:this.data.jobTitle.toUpperCase(),datePassed:new Date(this.data.datePassed)}),this.sps.getInfoSpcode(this.data.spCode).subscribe(e=>{this.mainForm.patchValue({spCode:e[0],nameSPcode:e[0].providerName,distributorSPCode:e[0].responsibleBranchCode+" - "+e[0].responsibleBranchName})})}),this.promotionId.disable(),this.promotionId.setValidators(null),this.spCode.disable(),this.spCode.setValidators(null),this.idCurso.disable(),this.idCurso.setValidators(null))}get promotionId(){return this.mainForm.get("promotionId")}get name(){return this.mainForm.get("name")}get secondName(){return this.mainForm.get("secondName")}get lastName(){return this.mainForm.get("lastName")}get spCode(){return this.mainForm.get("spCode")}get nameSPcode(){return this.mainForm.get("nameSPcode")}get distributorSPCode(){return this.mainForm.get("distributorSPCode")}get idCurso(){return this.mainForm.get("idCurso")}get courseName(){return this.mainForm.get("courseName")}get jobTitle(){return this.mainForm.get("jobTitle")}get datePassed(){return this.mainForm.get("datePassed")}showSpCodeLabelFn(e){return null==e?void 0:e.label}duplicatedPromotion(e){var t,i;if(this.isNew){const s={promotionId:e.value.promotionId,spCode:null===(t=e.value.spCode)||void 0===t?void 0:t.value,programId:null===(i=e.value.idCurso)||void 0===i?void 0:i.value};return this.prs.findByCriteria(s).pipe(Object(u.a)(e=>0===e.length||1==e.length&&!this.isNew?null:{duplicated:!0}),Object(p.a)(()=>this.changeDetectorRef.markForCheck()))}return Object(b.a)(null)}}return e.\u0275fac=function(t){return new(t||e)(c.Mb(o.d),c.Mb(r.g),c.Mb(r.s),c.Mb(r.p),c.Mb(r.n),c.Mb(c.h))},e.\u0275cmp=c.Gb({type:e,selectors:[["infL-main-form"]],inputs:{data:"data",dictionary:"dictionary"},decls:79,vars:38,consts:[["autocomplete","off",3,"formGroup"],["fxLayout","row","fxLayout.xs","column"],["fxFlex","100%"],["formControlName","promotionId","matInput","",3,"placeholder"],[4,"ngIf"],["fxFlex","50%"],["formControlName","name","matInput","",3,"placeholder"],["formControlName","secondName","matInput","",3,"placeholder"],["formControlName","lastName","matInput","",3,"placeholder"],[1,"example-full-width"],["formControlName","spCode","matInput","","required","","type","text",3,"matAutocomplete","placeholder"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["strokeWidth","3",3,"diameter",4,"ngIf"],["formControlName","nameSPcode","matInput","","readonly","",3,"placeholder"],["formControlName","distributorSPCode","matInput","","readonly","",3,"placeholder"],["type","text","matInput","","formControlName","idCurso",3,"placeholder","matAutocomplete"],["auto2","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formControlName","courseName","matInput","","readonly","",3,"placeholder"],["formControlName","jobTitle"],["formControlName","datePassed","matInput","","readonly","",3,"matDatepicker","placeholder"],["matSuffix","",3,"for"],["datePassed",""],[3,"value","onSelectionChange"],["strokeWidth","3",3,"diameter"],[3,"value"]],template:function(e,t){if(1&e&&(c.Sb(0,"form",0),c.Sb(1,"div",1),c.Sb(2,"div",2),c.Sb(3,"mat-form-field"),c.Nb(4,"input",3),c.Sb(5,"mat-error"),c.Bc(6,R,2,1,"ng-container",4),c.Bc(7,j,2,1,"ng-container",4),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Sb(8,"div",1),c.Sb(9,"div",5),c.Sb(10,"mat-form-field"),c.Nb(11,"input",6),c.Sb(12,"mat-error"),c.Bc(13,F,2,1,"ng-container",4),c.Bc(14,B,2,1,"ng-container",4),c.Rb(),c.Rb(),c.Rb(),c.Sb(15,"div",5),c.Sb(16,"mat-form-field"),c.Nb(17,"input",7),c.Sb(18,"mat-error"),c.Bc(19,I,2,1,"ng-container",4),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Sb(20,"div",1),c.Sb(21,"div",2),c.Sb(22,"mat-form-field"),c.Nb(23,"input",8),c.Sb(24,"mat-error"),c.Bc(25,P,2,1,"ng-container",4),c.Bc(26,x,2,1,"ng-container",4),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Sb(27,"div",1),c.Sb(28,"div",2),c.Sb(29,"mat-form-field",9),c.Nb(30,"input",10),c.Sb(31,"mat-autocomplete",11,12),c.Bc(33,L,2,2,"mat-option",13),c.fc(34,"async"),c.Rb(),c.Sb(35,"mat-error"),c.Dc(36),c.Rb(),c.Bc(37,D,1,1,"mat-spinner",14),c.Rb(),c.Rb(),c.Rb(),c.Sb(38,"div",1),c.Sb(39,"div",2),c.Sb(40,"mat-form-field"),c.Nb(41,"input",15),c.Rb(),c.Rb(),c.Rb(),c.Sb(42,"div",1),c.Sb(43,"div",2),c.Sb(44,"mat-form-field"),c.Nb(45,"input",16),c.Rb(),c.Rb(),c.Rb(),c.Sb(46,"div",1),c.Sb(47,"div",2),c.Sb(48,"mat-form-field",9),c.Nb(49,"input",17),c.Sb(50,"mat-autocomplete",11,18),c.Bc(52,E,2,2,"mat-option",19),c.fc(53,"async"),c.Rb(),c.Sb(54,"mat-error"),c.Dc(55),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Sb(56,"div",1),c.Sb(57,"div",2),c.Sb(58,"mat-form-field"),c.Nb(59,"input",20),c.Rb(),c.Rb(),c.Rb(),c.Sb(60,"div",1),c.Sb(61,"div",2),c.Sb(62,"mat-form-field"),c.Sb(63,"mat-label"),c.Dc(64),c.Rb(),c.Sb(65,"mat-select",21),c.Bc(66,w,2,2,"mat-option",19),c.Rb(),c.Sb(67,"mat-error"),c.Dc(68),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Sb(69,"div",1),c.Sb(70,"div",2),c.Sb(71,"mat-form-field"),c.Nb(72,"input",22),c.Nb(73,"mat-datepicker-toggle",23),c.Nb(74,"mat-datepicker",null,24),c.Sb(76,"mat-error"),c.Dc(77),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Bc(78,O,3,0,"mat-error",4),c.Rb()),2&e){const e=c.qc(32),i=c.qc(51),s=c.qc(75);c.jc("formGroup",t.mainForm),c.Bb(4),c.jc("placeholder",t.dictionary.translate("idPromotion")+" *"),c.Bb(2),c.jc("ngIf",t.promotionId.invalid&&t.promotionId.errors.required),c.Bb(1),c.jc("ngIf",t.promotionId.invalid&&t.promotionId.errors.maxlength),c.Bb(4),c.jc("placeholder",t.dictionary.translate("name")+" *"),c.Bb(2),c.jc("ngIf",t.name.invalid&&t.name.errors.required),c.Bb(1),c.jc("ngIf",t.name.invalid&&t.name.errors.maxlength),c.Bb(3),c.jc("placeholder",t.dictionary.translate("secondName")),c.Bb(2),c.jc("ngIf",t.secondName.invalid&&t.secondName.errors.maxlength),c.Bb(4),c.jc("placeholder",t.dictionary.translate("lastName")+" *"),c.Bb(2),c.jc("ngIf",t.lastName.invalid&&t.lastName.errors.required),c.Bb(1),c.jc("ngIf",t.lastName.invalid&&t.lastName.errors.maxlength),c.Bb(4),c.jc("matAutocomplete",e)("placeholder",t.dictionary.translate("spCode")),c.Bb(1),c.jc("displayWith",t.displayFn),c.Bb(2),c.jc("ngForOf",c.gc(34,34,t.filteredOptions)),c.Bb(3),c.Fc(" ",t.dictionary.translate("mandatoryField")," "),c.Bb(1),c.jc("ngIf",t.spCodeLoading),c.Bb(4),c.jc("placeholder",t.dictionary.translate("nameSPCode")),c.Bb(4),c.jc("placeholder",t.dictionary.translate("distributorSPCode")),c.Bb(4),c.jc("placeholder",t.dictionary.translate("idCourse")+" *")("matAutocomplete",i),c.Bb(1),c.jc("displayWith",t.showSpCodeLabelFn),c.Bb(2),c.jc("ngForOf",c.gc(53,36,t.filteredOptionsCurso)),c.Bb(3),c.Fc(" ",t.dictionary.translate("mandatoryField")," "),c.Bb(4),c.jc("placeholder",t.dictionary.translate("courseName")),c.Bb(5),c.Ec(t.dictionary.translate("jobTitle")+"*"),c.Bb(2),c.jc("ngForOf",t.jobTitles),c.Bb(2),c.Fc(" ",t.dictionary.translate("mandatoryField")," "),c.Bb(4),c.jc("matDatepicker",s)("placeholder",t.dictionary.translate("datePassed")+" *"),c.Bb(1),c.jc("for",s),c.Bb(4),c.Fc(" ",t.dictionary.translate("mandatoryField")," "),c.Bb(1),c.jc("ngIf",t.mainForm.hasError("duplicated"))}},directives:[o.t,o.m,o.f,h.c,h.a,f.c,o.c,g.b,o.l,o.e,f.b,s.l,v.c,o.r,v.a,s.k,f.f,y.a,C.b,C.d,f.g,C.a,S.n,N.c],pipes:[s.b],styles:[".mat-form-field[_ngcontent-%COMP%]{min-inline-size:95%}"]}),e})(),k=(()=>{class e{constructor(e,t,i){this.data=e,this.dialogRef=t,this.message=i,this.loading=!1}ngOnInit(){this.title=this.data.dictionary.translate(this.data.promotion?"editPromotion":"addPromotion"),console.log("main.form-dialog"),console.log(this)}onClose(){this.dialogRef.close()}onSubmit(){console.log("onSubmit"),this.loading=!0,this.mfc.disableFields(),this.mfc.submit().subscribe(e=>{this.loading=!1,this.mfc.enableFields(),this.dialogRef.close({})},e=>{this.loading=!1,this.mfc.enableFields(),this.message.genericHttpError()})}}return e.\u0275fac=function(t){return new(t||e)(c.Mb(d.a),c.Mb(d.f),c.Mb(r.k))},e.\u0275cmp=c.Gb({type:e,selectors:[["infL-main-form-dialog"]],viewQuery:function(e,t){var i;1&e&&c.Hc(M,!0),2&e&&c.pc(i=c.bc())&&(t.mfc=i.first)},decls:2,vars:7,consts:[[3,"disabled","loading","title","submitText","cancelText","closeEvent","submitEvent"],[2,"width","200px",3,"data","dictionary"]],template:function(e,t){1&e&&(c.Sb(0,"shared-form-dialog",0),c.ac("closeEvent",(function(){return t.onClose()}))("submitEvent",(function(){return t.onSubmit()})),c.Nb(1,"infL-main-form",1),c.Rb()),2&e&&(c.jc("disabled",t.loading||(null==t.mfc?null:t.mfc.mainForm.pristine)||!(null!=t.mfc&&t.mfc.mainForm.valid))("loading",t.loading)("title",t.title)("submitText",t.data.dictionary.translate("save"))("cancelText",t.data.dictionary.translate("cancel")),c.Bb(1),c.jc("data",t.data.promotion)("dictionary",t.data.dictionary))},directives:[r.f,M],styles:[""]}),e})();var T=i("DGrs"),q=i("8j5Y"),A=i("J+dc"),Q=i("J0Eg");let $=(()=>{class e extends Q.a{constructor(e,t){super(),this.ps=e,this.datePipe=t}loadData(e){let t;return t={promotionId:null==e?void 0:e.promotion,firstName:null==e?void 0:e.name,jobTitle:null==e?void 0:e.jobTitle,programId:null==e?void 0:e.pq,spCode:null==e?void 0:e.spcode},this.ps.findByCriteria(t).pipe(Object(q.a)(e=>{let t;for(let i=0;i<e.length;i++)t=new Date(e[i].datePassed),e[i].name=`${e[i].firstName||""} ${e[i].middleName||""} ${e[i].lastName||""}`.trim(),e[i].programName=e[i].program.nombre,e[i].datePassedStr=this.datePipe.transform(t,"MM-dd-yyyy");this.dataSource.replaceAll(e)}),Object(A.a)(1))}push(e){this.dataSource.push(e)}}return e.\u0275fac=function(t){return new(t||e)(c.Wb(r.p),c.Wb(s.e))},e.\u0275prov=c.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var U=i("+Tre"),V=i("PBFl");function W(e,t){1&e&&c.Nb(0,"shared-progress-bar")}let G=(()=>{class e{constructor(e,t,i,s,a){this.mts=e,this.sps=t,this.message=i,this.dialog=s,this.prs=a,this.columns=H,this.loading=!1,this.operations=J,this.subscriptions=[],this.massLoadFile=[],this.eraseData=!1,this.massiveLoadErrors=[],this.eventListeners(),this.mts.loadData(null).subscribe(e=>{this.dataSource=e})}ngOnInit(){for(let e=0;e<this.columns.length;e++)if(this.columns[e].label=this.dictionary.translate(H[e].label),"operations"==this.columns[e].label)for(let t=0;t<this.columns[e].value.length;t++)this.columns[e].value[t].label=this.dictionary.translate(H[e].value[t].label)}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onOperation(e){switch(e.operation){case"edit":this.onEdit(e.item);break;case"delete":this.onDelete(e.item)}}massLoadFunction(){this.loading=!0,this.sps.massiveLoad(this.massLoadFile[0].data,1==this.eraseData?"1":"0").pipe(Object(p.a)(()=>{this.mts.loadData(null).pipe(Object(p.a)(()=>this.loading=!1)).subscribe(e=>{this.dataSource=e}),this.openResults()})).subscribe(e=>{const t=[];e.forEach(e=>{(null==e?void 0:e.errores)&&(t.push("Registros Actualizados: "+e.registrosActualizados,"Registros Eliminados: "+e.registrosEliminados,"Registros Nuevos: "+e.registrosNuevos),t.push(...e.errores.map(e=>`Renglon: ${e.line} - ${e.errorType}`)))}),this.massiveLoadErrors=t},e=>{this.massiveLoadErrors=e})}onAdd(){this.dialog.open(k,{disableClose:!0,height:"450px",width:"600px",data:{dictionary:this.dictionary,promotion:null}}).afterClosed().subscribe(e=>{e&&(this.mts.push(e),this.mts.loadData(null).subscribe(e=>{this.dataSource=e}),this.message.genericSaveMessage())})}onEdit(e){this.dialog.open(k,{disableClose:!0,height:"450px",width:"600px",data:{dictionary:this.dictionary,promotion:e}}).afterClosed().subscribe(e=>{e&&(this.message.genericSaveMessage(),this.mts.loadData(null).subscribe(e=>{this.dataSource=e}))})}onDelete(e){this.loading=!0,this.prs.delete({promotionId:e.promotionId,spCode:e.spCode,programId:e.programId}).subscribe(e=>{this.message.show("Promotion Eliminada"),this.mts.loadData(null).subscribe(e=>{this.dataSource=e}),this.loading=!1},e=>{this.message.genericHttpError(),this.loading=!1})}eventListeners(){this.subscriptions.push(this.mts.dataEvent.subscribe(e=>this.operations.forEach(t=>t.disabled=0===e.length)))}openResults(){this.dialog.open(T.a,{disableClose:!1,height:"400px",width:"600px",data:{massiveLoadErrors:this.massiveLoadErrors}})}}return e.\u0275fac=function(t){return new(t||e)(c.Mb($),c.Mb(r.s),c.Mb(r.k),c.Mb(d.b),c.Mb(r.p))},e.\u0275cmp=c.Gb({type:e,selectors:[["infL-main-table"]],inputs:{dictionary:"dictionary"},decls:14,vars:14,consts:[[4,"ngIf"],[1,"mat-elevation-z8","p1"],["fxLayout","row","fxLayout.xs","column","fxLayoutAlign","space-around center"],["accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",3,"disabled","files","option","lengthFile"],[3,"ngModel","ngModelChange"],["mat-raised-button","",3,"disabled","click"],[3,"dictionary","columns","data","showPagination","operationEvent"],[3,"text","callback"]],template:function(e,t){1&e&&(c.Bc(0,W,1,0,"shared-progress-bar",0),c.Sb(1,"div",1),c.Sb(2,"div",2),c.Sb(3,"div"),c.Nb(4,"shared-file-upload-control",3),c.Rb(),c.Sb(5,"div"),c.Sb(6,"mat-checkbox",4),c.ac("ngModelChange",(function(e){return t.eraseData=e})),c.Dc(7),c.Rb(),c.Rb(),c.Sb(8,"div"),c.Sb(9,"button",5),c.ac("click",(function(){return t.massLoadFunction()})),c.Dc(10),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Nb(11,"br"),c.Sb(12,"shared-search-table",6),c.ac("operationEvent",(function(e){return t.onOperation(e)})),c.Rb(),c.Sb(13,"shared-add-button",7),c.ac("callback",(function(){return t.onAdd()})),c.Rb()),2&e&&(c.jc("ngIf",t.loading),c.Bb(4),c.jc("disabled",!1)("files",t.massLoadFile)("option",t.dictionary.translate("fileUp"))("lengthFile",t.dictionary.translate("lengthFile")),c.Bb(2),c.jc("ngModel",t.eraseData),c.Bb(1),c.Fc(" ",t.dictionary.translate("eraseBefore")," "),c.Bb(2),c.jc("disabled",!t.massLoadFile[0]||t.loading),c.Bb(1),c.Fc(" ",t.dictionary.translate("massive")," "),c.Bb(2),c.jc("dictionary",t.dictionary)("columns",t.columns)("data",t.dataSource)("showPagination",!0),c.Bb(1),c.jc("text",t.dictionary.translate("addPromotion")))},directives:[s.l,h.c,h.b,r.e,U.a,o.l,o.o,V.b,r.v,r.a,r.o],styles:[""]}),e})();const H=[{key:"promotionId",label:"idPromotion"},{key:"name",label:"firstName"},{key:"jobTitle",label:"jobTitle"},{key:"programId",label:"Program ID"},{key:"spCode",label:"spCode"},{key:"datePassedStr",label:"datePassed"},{key:"operations",label:"actions",type:r.b.Operations,value:[{label:"edit",matIcon:"edit",operation:"edit"},{label:"delete",matIcon:"delete",operation:"delete"}]}],J=[{disabled:!1,faIcon:"faFileExcel",label:"Exportar Reporte",operation:"export"}];function z(e,t){if(1&e&&(c.Sb(0,"div"),c.Nb(1,"infL-main-table",1),c.Rb()),2&e){const e=c.ec();c.Bb(1),c.jc("dictionary",e.dictionary)}}let _=(()=>{class e{constructor(e,t,i,s,a,o,n){this.dialog=e,this.message=t,this.mts=i,this.sps=s,this.ps=a,this.prs=o,this.tls=n,this.dictionary=new r.j,this.fields=Y,this.loading=!1,this.massLoadFile=[],this.eraseData=!1,this.massiveLoadErrors=[],this.flag=!1}ngOnInit(){this.tls.getLenguaje().subscribe(e=>{this.dictionary.setLanguage(e.language),this.flag=!0}),this.sps.bringTheActivesSPCodes().subscribe(e=>{this.fields[2].options=e}),this.ps.bringTheActivesPQs().subscribe(e=>{this.fields[3].options=e}),this.prs.bringRelPuestos().subscribe(e=>{this.fields[4].options=e})}massLoadFunction(){this.loading=!0,this.sps.massiveLoad(this.massLoadFile[0].data,1==this.eraseData?"1":"0").pipe(Object(p.a)(()=>{this.mts.loadData(null).pipe(Object(p.a)(()=>this.loading=!1)).subscribe(),this.openResults()})).subscribe(e=>{const t=[];e.forEach(e=>{(null==e?void 0:e.errores)&&(t.push("Registros Actualizados: "+e.registrosActualizados,"Registros Eliminados: "+e.registrosEliminados,"Registros Nuevos: "+e.registrosNuevos),t.push(...e.errores.map(e=>`Renglon: ${e.line} - ${e.errorType}`)))}),this.massiveLoadErrors=t},e=>{this.massiveLoadErrors=e})}onAdd(){this.dialog.open(k,{disableClose:!0,height:"450px",width:"600px",data:{dictionary:this.dictionary,promotion:null}}).afterClosed().subscribe(e=>{e&&(this.mts.push(e),this.mts.loadData(null).subscribe(),this.message.genericSaveMessage())})}onSearch(e){return console.log(e),e?(this.loading=!0,this.mts.loadData(e).subscribe(()=>{},e=>this.message.genericHttpError(e),()=>this.loading=!1)):this.mts.loadData(null).subscribe(),null}openResults(){this.dialog.open(T.a,{disableClose:!1,height:"400px",width:"600px",data:{massiveLoadErrors:this.massiveLoadErrors}})}}return e.\u0275fac=function(t){return new(t||e)(c.Mb(d.b),c.Mb(r.k),c.Mb($),c.Mb(r.s),c.Mb(r.n),c.Mb(r.p),c.Mb(r.u))},e.\u0275cmp=c.Gb({type:e,selectors:[["infL-main-view"]],decls:1,vars:1,consts:[[4,"ngIf"],[3,"dictionary"]],template:function(e,t){1&e&&c.Bc(0,z,2,1,"div",0),2&e&&c.jc("ngIf",t.flag)},directives:[s.l,G],styles:[""]}),e})();const Y=[{label:"Promotion",type:"text",value:"promotion"},{label:"Nombre",type:"text",value:"name"},{label:"SP Code",options:[],type:"select",value:"spcode"},{label:"PQ",options:[],type:"select",value:"pq"},{label:"Puesto",options:[],type:"select",value:"jobTitle"}],K=[{component:_,path:""}];let Z=(()=>{class e{}return e.\u0275mod=c.Kb({type:e}),e.\u0275inj=c.Jb({factory:function(t){return new(t||e)},imports:[[l.a.forChild(K)],l.a]}),e})();var X=i("KZIX"),ee=i("FlRo"),te=i("cePI"),ie=i("iAde"),se=i("k8N0"),ae=i("bFHC"),oe=i("Jb3d"),re=i("66mq");let ne=(()=>{class e{}return e.\u0275mod=c.Kb({type:e}),e.\u0275inj=c.Jb({factory:function(t){return new(t||e)},imports:[[s.c,Z,a.a,o.g,C.c,f.e,g.c,S.m,y.b,X.a,ee.m,o.q,te.c,ie.b,se.a,r.t,n.a,V.c,d.e,ae.b,oe.b,re.b,N.b,v.b,U.b]]}),e})()}}]);